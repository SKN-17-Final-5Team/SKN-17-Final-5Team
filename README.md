# ë¬´ì—­ ì „ë¬¸ê°€ RAG ì‹œìŠ¤í…œ ğŸš€

> Reranker ê¸°ë°˜ ê³ ë„í™” RAG ì‹œìŠ¤í…œìœ¼ë¡œ ë¬´ì—­ ê´€ë ¨ ì§ˆë¬¸ì— ì •í™•í•˜ê²Œ ë‹µë³€í•˜ëŠ” AI Agent

---

## ğŸ“Œ í”„ë¡œì íŠ¸ ì†Œê°œ

ì´ í”„ë¡œì íŠ¸ëŠ” **ë¬´ì—­ì‚¬ê¸°, CISG, Incoterms, ë¬´ì—­í´ë ˆì„, í•´ì™¸ì¸ì¦** ì •ë³´ë¥¼ ë‹¤ë£¨ëŠ” ì „ë¬¸ RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- âœ… **Qdrant Vector DB**: 5ê°€ì§€ ë¬´ì—­ ë°ì´í„° ì†ŒìŠ¤ í†µí•© ê²€ìƒ‰
- âœ… **Reranker API**: RunPod ì„œë²„ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ ì¬ì •ë ¬ (ì„ íƒ ê°€ëŠ¥)
- âœ… **OpenAI GPT-4**: ê³ í’ˆì§ˆ ë‹µë³€ ìƒì„±
- âœ… **ëª¨ë“ˆí™” êµ¬ì¡°**: ìœ ì§€ë³´ìˆ˜ ë° í™•ì¥ ìš©ì´

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1ë‹¨ê³„: í™˜ê²½ ì„¤ì •

```bash
# ì €ì¥ì†Œ í´ë¡  (ë˜ëŠ” í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™)
cd SKN-17-Final-5Team

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

### 2ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:

```env
# OpenAI API
OPENAI_API_KEY=your-openai-api-key

# Qdrant Vector DB
QDRANT_URL=your-qdrant-url
QDRANT_API_KEY=your-qdrant-api-key

# Reranker API (ì„ íƒì‚¬í•­)
RERANKER_API_URL=your-reranker-api-url
```

### 3ë‹¨ê³„: ì‹¤í–‰

```bash
python main.py
```

### 4ë‹¨ê³„: ì‚¬ìš©

1. Reranker ì‚¬ìš© ì—¬ë¶€ ì„ íƒ (y/n)
2. ì§ˆë¬¸ ì…ë ¥ (ê¸°ë³¸ê°’: "ë¬´ì—­ ì‚¬ê¸°ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•ì€?")
3. Agent ë‹µë³€ í™•ì¸

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
SKN-17-Final-5Team/
â”œâ”€â”€ main.py                      # ì‹¤í–‰ ì§„ì…ì  â­
â”œâ”€â”€ config.py                    # ì„¤ì • ë° í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ utils.py                     # í—¬í¼ í•¨ìˆ˜
â”œâ”€â”€ requirements.txt             # ì˜ì¡´ì„± ëª©ë¡
â”œâ”€â”€ .env                         # í™˜ê²½ë³€ìˆ˜ (ìƒì„± í•„ìš”)
â”‚
â”œâ”€â”€ my_agents/                      # Agent ì •ì˜
â”‚   â”œâ”€â”€ trade_agent.py          # ë¬´ì—­ ì „ë¬¸ê°€ Agent
â”‚   â””â”€â”€ prompts/
â”‚       â””â”€â”€ trade_instructions.txt  # Agent í”„ë¡¬í”„íŠ¸
â”‚
â”œâ”€â”€ models/                      # ë°ì´í„° ëª¨ë¸
â”‚   â””â”€â”€ reranker.py             # Reranker API ëª¨ë¸
â”‚
â”œâ”€â”€ services/                    # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â””â”€â”€ reranker_service.py     # Reranker API í˜¸ì¶œ
â”‚
â”œâ”€â”€ tools/                       # Agent ë„êµ¬
â”‚   â””â”€â”€ search_tool.py          # ë¬¸ì„œ ê²€ìƒ‰ ë„êµ¬
â”‚
â”œâ”€â”€ tests/                       # í…ŒìŠ¤íŠ¸ ì½”ë“œ ğŸ§ª
â”‚   â”œâ”€â”€ README.md               # í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
â”‚   â”œâ”€â”€ conftest.py             # ê³µí†µ fixture
â”‚   â”œâ”€â”€ test_*.py               # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ data_embedding/              # ë²¡í„°í™” ìŠ¤í¬ë¦½íŠ¸ (ë°ì´í„° ì¤€ë¹„ìš©)
â””â”€â”€ archive/                     # ë°±ì—… íŒŒì¼
```

---

## ğŸ’¡ ì£¼ìš” ê¸°ëŠ¥

### 1ï¸âƒ£ Reranker ëª¨ë“œ ì„ íƒ

ì‹¤í–‰ ì‹œ Reranker ì‚¬ìš© ì—¬ë¶€ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**Reranker ì‚¬ìš© (y):**
- Qdrantì—ì„œ 25ê°œ ë¬¸ì„œ ê²€ìƒ‰
- Reranker APIë¡œ ì¬ì •ë ¬
- ìƒìœ„ 5ê°œë§Œ Agentì— ì „ë‹¬
- **ì¥ì **: ë” ì •í™•í•œ ê²€ìƒ‰ ê²°ê³¼

**Reranker ë¯¸ì‚¬ìš© (n):**
- Qdrantì—ì„œ 5ê°œ ë¬¸ì„œ ì§ì ‘ ê²€ìƒ‰
- Agentì— ë°”ë¡œ ì „ë‹¬
- **ì¥ì **: ë¹ ë¥¸ ì‘ë‹µ ì†ë„

### 2ï¸âƒ£ ë°ì´í„° ì†ŒìŠ¤

| ì¶œì²˜ | ë‚´ìš© | ë©”íƒ€ë°ì´í„° |
|------|------|-----------|
| **fraud** | 2025 ë¬´ì—­ì‚¬ê¸° ëŒ€ì‘ ë§¤ë‰´ì–¼ | file_name, chunk_index |
| **incoterms** | Incoterms 2020 ê·œì¹™ | - |
| **claim** | ë¬´ì—­ í´ë ˆì„ ì¤‘ì¬ Q&A | document_name |
| **certification** | í•´ì™¸ ì¸ì¦ ì •ë³´ | title, country, category |
| **cisg** | êµ­ì œë¬¼í’ˆë§¤ë§¤ê³„ì•½ UN í˜‘ì•½ | article, paragraph_no |

### 3ï¸âƒ£ ê²€ìƒ‰ ê²°ê³¼ ì¶œë ¥ ì˜ˆì‹œ

```
============================================================
ğŸ“„ ê²€ìƒ‰ëœ ë¬¸ì„œ (ì´ 25ê°œ ì¤‘ 5ê°œ í‘œì‹œ)
============================================================

ë¬¸ì„œ 1:
  ì¶œì²˜: fraud
  ì ìˆ˜: 0.856
  ë‚´ìš©: ë¬´ì—­ ì‚¬ê¸°ë¥¼ ì˜ˆë°©í•˜ê¸° ìœ„í•´ì„œëŠ”...

ë¬¸ì„œ 2:
  ì¶œì²˜: cisg
  ì ìˆ˜: 0.823
  ë‚´ìš©: ì œ25ì¡°ì— ë”°ë¥´ë©´ ê³„ì•½ì˜ ì¤‘ëŒ€í•œ ìœ„ë°˜ì€...

============================================================
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰

í”„ë¡œì íŠ¸ëŠ” pytest ê¸°ë°˜ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pytest

# ìì„¸í•œ ì¶œë ¥
pytest -v

# ì»¤ë²„ë¦¬ì§€ ì¸¡ì •
pytest --cov=. --cov-report=html
```

ë” ìì„¸í•œ ë‚´ìš©ì€ [tests/README.md](tests/README.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

## ğŸ› ï¸ ë¬¸ì œ í•´ê²°

### 1. `ModuleNotFoundError: No module named 'XXX'`

**ì›ì¸**: í•„ìš”í•œ íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

**í•´ê²°**:
```bash
pip install -r requirements.txt
```

### 2. `.env` íŒŒì¼ ê´€ë ¨ ì—ëŸ¬

**ì›ì¸**: í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

**í•´ê²°**:
- í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ ìƒì„±
- í•„ìˆ˜ ë³€ìˆ˜ 3ê°œ ì„¤ì •: `OPENAI_API_KEY`, `QDRANT_URL`, `QDRANT_API_KEY`

### 3. Reranker API íƒ€ì„ì•„ì›ƒ

**ì›ì¸**: Reranker ì„œë²„ê°€ ì‘ë‹µí•˜ì§€ ì•Šê±°ë‚˜ URLì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.

**í•´ê²°**:
- Reranker ì„œë²„ ìƒíƒœ í™•ì¸
- ì‹¤í–‰ ì‹œ Reranker ë¯¸ì‚¬ìš©(n) ì„ íƒ

### 4. Qdrant ì—°ê²° ì‹¤íŒ¨

**ì›ì¸**: Qdrant URLì´ë‚˜ API í‚¤ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.

**í•´ê²°**:
- `.env` íŒŒì¼ì˜ `QDRANT_URL`ê³¼ `QDRANT_API_KEY` í™•ì¸
- Qdrant Cloud ëŒ€ì‹œë³´ë“œì—ì„œ ì¸ì¦ ì •ë³´ ì¬í™•ì¸

---

## ğŸ“š ì¶”ê°€ ë¬¸ì„œ

- **í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ**: [tests/README.md](tests/README.md)
- **Agent í”„ë¡¬í”„íŠ¸**: [my_agents/prompts/trade_instructions.txt](my_agents/prompts/trade_instructions.txt)
- **ì•„ì¹´ì´ë¸Œ (ì´ì „ ë²„ì „)**: [archive/](archive/)

---

## ğŸ”§ ê°œë°œ ì°¸ê³ ì‚¬í•­

### ì½”ë“œ ìˆ˜ì • ì‹œ

1. ê¸°ëŠ¥ êµ¬í˜„
2. í…ŒìŠ¤íŠ¸ ì‘ì„± (`tests/test_*.py`)
3. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (`pytest -v`)
4. ì»¤ë°‹ ì „ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### ìƒˆë¡œìš´ Agent ì¶”ê°€

1. `agents/` ë””ë ‰í† ë¦¬ì— ìƒˆ Agent íŒŒì¼ ìƒì„±
2. `my_agents/prompts/`ì— í”„ë¡¬í”„íŠ¸ íŒŒì¼ ì¶”ê°€
3. `tools/`ì— í•„ìš”í•œ ë„êµ¬ ì¶”ê°€ (í•„ìš” ì‹œ)
4. `main.py`ì—ì„œ Agent ì„ íƒ ë¡œì§ ì¶”ê°€

### ìƒˆë¡œìš´ ë°ì´í„° ì†ŒìŠ¤ ì¶”ê°€

1. `data_embedding/`ì— ë²¡í„°í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
2. `data_source` ë©”íƒ€ë°ì´í„° ê°’ ì„¤ì • (ì˜ˆ: `new_source`)
3. Qdrantì— ì—…ë¡œë“œ
4. `utils.py`ì˜ `print_retrieved_documents()`ì— ì¶œì²˜ ì¶”ê°€ (ì„ íƒ)

---

## ğŸ“ ë¬¸ì˜

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì€ íŒ€ ì±„ë„ë¡œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”! ğŸ™‹â€â™‚ï¸

---

**Made with â¤ï¸ by SKN-17 Final 5Team**
